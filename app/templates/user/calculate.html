{% extends "base.html" %}

{% block title %}–†–∞—Å—á—ë—Ç —Ä–∞—Ü–∏–æ–Ω–∞ - Nutrition Calculator{% endblock %}

{% block head %}
<style>
    .nutrition-card {
        transition: transform 0.2s;
    }
    .nutrition-card:hover {
        transform: translateY(-2px);
    }
    .nutrition-value {
        font-feature-settings: "tnum";
        font-variant-numeric: tabular-nums;
    }
</style>
{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- –§–æ—Ä–º–∞ —Ä–∞—Å—á—ë—Ç–∞ -->
    <div>
        <div class="card">
            <h2 class="text-2xl font-medium mb-6">
                <i class="bi bi-calculator-fill mr-2"></i>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–∞—Ü–∏–æ–Ω–∞
            </h2>
            
            <form method="POST" action="{{ url_for('user.calculate') }}" class="space-y-6">
                {{ form.hidden_tag() }}
                
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block mb-2">–ö–∞–ª–æ—Ä–∏–∏</label>
                        {{ form.target_calories(class="form-control", placeholder="2000") }}
                    </div>
                    <div>
                        <label class="block mb-2">–ë–µ–ª–∫–∏ (–≥)</label>
                        {{ form.target_proteins(class="form-control", placeholder="150") }}
                    </div>
                    <div>
                        <label class="block mb-2">–ñ–∏—Ä—ã (–≥)</label>
                        {{ form.target_fats(class="form-control", placeholder="70") }}
                    </div>
                    <div>
                        <label class="block mb-2">–£–≥–ª–µ–≤–æ–¥—ã (–≥)</label>
                        {{ form.target_carbs(class="form-control", placeholder="250") }}
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary w-full py-3">
                    <i class="bi bi-lightning-charge"></i> –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ä–∞—Ü–∏–æ–Ω
                </button>
            </form>
        </div>
        
        <!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã -->
        <div class="card mt-6">
            <h3 class="text-xl font-medium mb-4">
                <i class="bi bi-basket mr-2"></i>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
            </h3>
            <div class="max-h-60 overflow-y-auto">
                <div class="grid grid-cols-1 gap-2">
                    {% for ingredient in ingredients %}
                    <div class="flex items-center justify-between p-3 bg-accent rounded-lg">
                        <div>
                            <span class="font-medium">{{ ingredient.name }}</span>
                            <span class="text-sm text-muted-foreground ml-2">
                                {{ ingredient.calories }} –∫–∫–∞–ª
                            </span>
                        </div>
                        <div class="text-sm">
                            <span class="bg-primary text-primary-foreground px-2 py-1 rounded">
                                {{ ingredient.proteins }}–≥
                            </span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    <div>
        {% if result and result.success %}
        <div class="card mb-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-medium">
                    <i class="bi bi-check-circle-fill text-green-500 mr-2"></i>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–∞
                </h2>
                <span class="badge badge-primary">{{ result.total_weight|round(1) }} –≥</span>
            </div>
            
            <!-- –°–≤–æ–¥–∫–∞ –ø–æ –ö–ë–ñ–£ -->
            <div class="grid grid-cols-4 gap-4 mb-6">
                <div class="nutrition-card bg-card border border-border rounded-lg p-4 text-center">
                    <div class="text-2xl font-medium text-green-600 nutrition-value">
                        {{ result.total_nutrition.calories }}
                    </div>
                    <div class="text-sm text-muted-foreground">–∫–∫–∞–ª</div>
                    <div class="text-xs mt-1">
                        <span class="{% if result.deviations.calories|abs < 5 %}text-green-500{% else %}text-yellow-500{% endif %}">
                            {{ result.deviations.calories }}%
                        </span>
                    </div>
                </div>
                
                <div class="nutrition-card bg-card border border-border rounded-lg p-4 text-center">
                    <div class="text-2xl font-medium text-blue-600 nutrition-value">
                        {{ result.total_nutrition.proteins }}
                    </div>
                    <div class="text-sm text-muted-foreground">–±–µ–ª–∫–∏</div>
                    <div class="text-xs mt-1">
                        <span class="{% if result.deviations.proteins|abs < 5 %}text-green-500{% else %}text-yellow-500{% endif %}">
                            {{ result.deviations.proteins }}%
                        </span>
                    </div>
                </div>
                
                <div class="nutrition-card bg-card border border-border rounded-lg p-4 text-center">
                    <div class="text-2xl font-medium text-yellow-600 nutrition-value">
                        {{ result.total_nutrition.fats }}
                    </div>
                    <div class="text-sm text-muted-foreground">–∂–∏—Ä—ã</div>
                    <div class="text-xs mt-1">
                        <span class="{% if result.deviations.fats|abs < 5 %}text-green-500{% else %}text-yellow-500{% endif %}">
                            {{ result.deviations.fats }}%
                        </span>
                    </div>
                </div>
                
                <div class="nutrition-card bg-card border border-border rounded-lg p-4 text-center">
                    <div class="text-2xl font-medium text-purple-600 nutrition-value">
                        {{ result.total_nutrition.carbs }}
                    </div>
                    <div class="text-sm text-muted-foreground">—É–≥–ª–µ–≤–æ–¥—ã</div>
                    <div class="text-xs mt-1">
                        <span class="{% if result.deviations.carbs|abs < 5 %}text-green-500{% else %}text-yellow-500{% endif %}">
                            {{ result.deviations.carbs }}%
                        </span>
                    </div>
                </div>
            </div>
            
            <!-- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã -->
            <h3 class="text-xl font-medium mb-4">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</h3>
            <div class="space-y-3">
                {% for ing_data in result.ingredients.values() %}
                <div class="flex items-center justify-between p-3 bg-accent rounded-lg">
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <span class="font-medium">{{ ing_data.ingredient.name }}</span>
                            {% if ing_data.ingredient.is_public %}
                            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">–û–±—â–∏–π</span>
                            {% endif %}
                        </div>
                        <div class="text-sm text-muted-foreground mt-1">
                            <span class="mr-3">{{ ing_data.ingredient.calories|round(1) }} –∫–∫–∞–ª/100–≥</span>
                            <span>–ë:{{ ing_data.ingredient.proteins|round(1) }} –ñ:{{ ing_data.ingredient.fats|round(1) }} –£:{{ ing_data.ingredient.carbs|round(1) }}</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-lg font-medium">{{ ing_data.grams|round(1) }} –≥</div>
                        <div class="text-sm text-muted-foreground">
                            {{ ing_data.nutrition.calories|round(1) }} –∫–∫–∞–ª
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <!-- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã -->
        {% if best_recipes %}
        <div class="card">
            <h2 class="text-2xl font-medium mb-6">
                <i class="bi bi-stars mr-2"></i>–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã
            </h2>
            
            <div class="space-y-4">
                {% for recipe_data in best_recipes %}
                <div class="border border-border rounded-lg p-4 hover:bg-accent transition-colors">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-lg font-medium">{{ recipe_data.recipe.name }}</h3>
                        <div class="flex items-center gap-2">
                            <span class="text-xs bg-primary text-primary-foreground px-2 py-1 rounded">
                                {{ recipe_data.score|round(2) }}
                            </span>
                            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">
                                {{ recipe_data.match_percentage|round(1) }}% —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                            </span>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-2 mb-3">
                        <div class="text-center">
                            <div class="text-sm font-medium">{{ recipe_data.nutrition.calories }}</div>
                            <div class="text-xs text-muted-foreground">–∫–∫–∞–ª</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-medium">{{ recipe_data.nutrition.proteins }}–≥</div>
                            <div class="text-xs text-muted-foreground">–±–µ–ª–∫–∏</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-medium">{{ recipe_data.nutrition.fats }}–≥</div>
                            <div class="text-xs text-muted-foreground">–∂–∏—Ä—ã</div>
                        </div>
                        <div class="text-center">
                            <div class="text-sm font-medium">{{ recipe_data.nutrition.carbs }}–≥</div>
                            <div class="text-xs text-muted-foreground">—É–≥–ª–µ–≤–æ–¥—ã</div>
                        </div>
                    </div>
                    
                    <div class="text-sm text-muted-foreground mb-3">
                        {% if recipe_data.recipe.description %}
                        <p>{{ recipe_data.recipe.description|truncate(100) }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="flex items-center justify-between">
                        <div class="text-xs text-muted-foreground">
                            <i class="bi bi-basket"></i>
                            {{ recipe_data.matching_count }} —Å–æ–≤–ø–∞–¥–∞—é—â–∏—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
                        </div>
                        <a href="{{ url_for('user.my_recipes') }}?recipe={{ recipe_data.recipe.id }}" 
                           class="text-sm text-primary hover:underline">
                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
        
        {% else %}
        <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–æ—Å–µ—â–µ–Ω–∏–∏ -->
        <div class="card">
            <h2 class="text-2xl font-medium mb-6">
                <i class="bi bi-info-circle mr-2"></i>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
            </h2>
            
            <div class="space-y-4">
                <div class="flex items-start gap-3">
                    <div class="flex-shrink-0 w-8 h-8 bg-primary text-primary-foreground rounded-full flex items-center justify-center">
                        1
                    </div>
                    <div>
                        <h4 class="font-medium mb-1">–í–≤–µ–¥–∏—Ç–µ —Ü–µ–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ö–ë–ñ–£</h4>
                        <p class="text-sm text-muted-foreground">
                            –£–∫–∞–∂–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–µ –∫–∞–ª–æ—Ä–∏–∏, –±–µ–ª–∫–∏, –∂–∏—Ä—ã –∏ —É–≥–ª–µ–≤–æ–¥—ã –¥–ª—è –≤–∞—à–µ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞.
                        </p>
                    </div>
                </div>
                
                <div class="flex items-start gap-3">
                    <div class="flex-shrink-0 w-8 h-8 bg-primary text-primary-foreground rounded-full flex items-center justify-center">
                        2
                    </div>
                    <div>
                        <h4 class="font-medium mb-1">–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã</h4>
                        <p class="text-sm text-muted-foreground">
                            –ê–ª–≥–æ—Ä–∏—Ç–º –ø–æ–¥–±–µ—Ä—ë—Ç –Ω–∞–∏–ª—É—á—à–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤.
                        </p>
                    </div>
                </div>
                
                <div class="flex items-start gap-3">
                    <div class="flex-shrink-0 w-8 h-8 bg-primary text-primary-foreground rounded-full flex items-center justify-center">
                        3
                    </div>
                    <div>
                        <h4 class="font-medium mb-1">–ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ—Ü–µ–ø—Ç–∞–º</h4>
                        <p class="text-sm text-muted-foreground">
                            –ù–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã.
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="mt-6 p-4 bg-accent rounded-lg">
                <h4 class="font-medium mb-2">üí° –°–æ–≤–µ—Ç</h4>
                <p class="text-sm text-muted-foreground">
                    –î–ª—è –Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–ª–∏ —Ä–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —Å–≤–æ–∏ —Ü–µ–ª–∏
                    —Å –ø–æ–º–æ—â—å—é –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π.
                </p>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}